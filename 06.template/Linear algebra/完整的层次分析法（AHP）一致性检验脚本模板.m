% 这是一个完整的层次分析法（AHP）一致性检验脚本模板。
% 它将自动计算矩阵的最大特征向量，并进行一致性检验。

% -----------------------------------------------------------------
% 步骤1: 定义你的判断矩阵
% -----------------------------------------------------------------
% 请将你的判断矩阵填入这里。
% 例子：一个 3x3 的矩阵
A = [1, 2, 1/3;
     1/2, 1, 1/4;
     3, 4, 1];

% 如果你的矩阵是不同的阶数，请替换上面的 A 矩阵。

% 获取矩阵的阶数 n
n = size(A, 1);

% -----------------------------------------------------------------
% 步骤2: 计算最大特征值和对应的特征向量
% -----------------------------------------------------------------
% 使用 eig 函数计算所有特征值和特征向量
[V, D] = eig(A);

% 提取所有特征值（它们在对角矩阵 D 的对角线上）
eigenvalues = diag(D);

% 找到最大特征值（绝对值）的索引
[~, max_index] = max(abs(eigenvalues));

% 获取最大特征值
lambda_max = eigenvalues(max_index);

% 获取对应的特征向量
% 注意: MATLAB 返回的是归一化的特征向量
eigenvector_max = V(:, max_index);

% -----------------------------------------------------------------
% 步骤3: 计算一致性指标 CI
% -----------------------------------------------------------------
% CI 的计算公式: (lambda_max - n) / (n - 1)
% 如果 n=1，CI 为 0
if n == 1
    CI = 0;
else
    CI = (lambda_max - n) / (n - 1);
end

% -----------------------------------------------------------------
% 步骤4: 查随机一致性指标 RI 表
% -----------------------------------------------------------------
% 预定义的标准 RI 值表（用于 n=1到15）
RI = [0, 0, 0.58, 0.90, 1.12, 1.24, 1.32, 1.41, 1.45, 1.49, 1.51, 1.54, 1.56, 1.58, 1.59];

% 检查 n 是否在 RI 表的范围内
if n > length(RI)
    error('警告: 矩阵阶数过大，超出预定义 RI 表的范围！');
end

% 获取对应的 RI 值
RI_value = RI(n);

% -----------------------------------------------------------------
% 步骤5: 计算一致性比例 CR
% -----------------------------------------------------------------
if n == 1 || RI_value == 0
    % 对于 n=1 或 n=2 的情况，CR 自动为 0
    CR = 0;
else
    CR = CI / RI_value;
end

% -----------------------------------------------------------------
% 步骤6: 显示所有结果并进行判断
% -----------------------------------------------------------------
fprintf('--- AHP 一致性检验结果 ---\n');
fprintf('矩阵阶数 (n): %d\n', n);
fprintf('最大特征值 (λ_max): %.4f\n', lambda_max);
fprintf('最大特征值对应的特征向量:\n');
disp(eigenvector_max);
fprintf('一致性指标 (CI): %.4f\n', CI);
fprintf('随机一致性指标 (RI): %.4f\n', RI_value);
fprintf('一致性比例 (CR): %.4f\n', CR);

% 判断一致性是否可接受
if CR < 0.1
    fprintf('\n结论: CR < 0.1, 矩阵一致性可接受。\n');
else
    fprintf('\n结论: CR >= 0.1, 矩阵一致性较差，需要调整判断矩阵。\n');
end
